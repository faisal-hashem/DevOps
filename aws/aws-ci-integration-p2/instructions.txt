Continuous Integration Process:
Code should be build and test everytime there is a commit. This is CI. If there is a manual build in place, this will not be possible.

Server Approach: Manual overhead and time consuming.
Cloud Services: Set up AWS CI Pipeline. Short MTTR (Mean Time To Repair), AGILE, No OPs, No Human Intervention

AWS Tools:
- Code Commmit (Version Control System)
- Code Artifact (Maven Repo for Dependencies)
- Code Build (Build Sservice from AWS)
- Code Deploy (Artifact Deloyment Service)

- SonarCloud  (Sonarqube Cloud Services)
- Checkstyle (Code Analysis from Build Job)
- Code Pipeline (Service to Integrate all jobs together)

Architecture AWS Pipeline:
Source --> Review --> Build

Source: (AWS Code Commit) --> Review: (AWS CodeBuild - Pull Dependencies from AWS CodeArtifact) <-> SonarCloud --> Build (AWS CodeBuild - Pulls Dependencies from AWS CodeArtifact) --> AWS S3 Bucket (Artifact Storage)

Step 1: Code Commit Setup
- Create CodeCommit Repo:
    - Create Maven repository - vprofile-code-repo
- IAM User with custom policies for CC - one to one access to CC
    - In IAM, create user- vprofile-code-admin - Add policy and create new custom policy. Give all CodeCommit rights. 
    - Select Specify ARN, and select Account, your region (us-east-2), repo name you created earlier.
    - Give policy name: vprofile-repo-fullaccess
    - Go back to previous tab, search for the newly created policy and click add. user is created now. 
    - Create access key for this user under Security Credentials. Save the CSV file with all the info. 
    - Make sure to have aws cli, run aws --Version
    - run aws configure and add your access id and access key here
- SSH auth to CodeCommit Repo from our local machine:
    - Create a SSH key. ssh-keygen and use the name vpro-codecommit_rsa
    - Upload public key to the AWS User we just created. 
    - Now we will need to create a config file that basically says to use the private key when the public key is being used during authentication
    - in .ssh directory add a file called config with the following:
        Host git-codecommit.*.amazonaws.com
        User AKIAQMS5XWRIVdfsdfHP4 (this is your SSH key ID from AWS)
        IdentityFile ~/.ssh/vpro-codecommit_rsa
    - Now the private key will be used during SSH, you can test by: ssh -v git-codecommit.us-east-2.amazonaws.com 
    - Make sure the connection is successful. If not, re-create the ssh key pair and re-upload and make sure there is no extra spaces.



- Migrate vProfile repo from Github to codecommit. Clone to our PC and then upload to CodeCommit repo
    - Do a git clone https://github.com/hkhcoder/vprofile-project.git
    - cd into this
    - run cat .git/config .. In the url remote origin, we will need to replace that to your aws code commit
    - Before doing this, lets first go through all the branches we want to migrate to aws:
        - git branch -a
        - git checkout aws-ci 
        - git checkout aws-cd 
        - git checkout ci-jenkins
        - git checkout docker
    - You can also use a for loop against the entire list of git branches -a and checkout them all by running the following:
    - git branch -a | grep remotes | grep -v HEAD | cut -d / -f3 > ./br
    - To view each value in the for loop run this: for i in `cat ./br` ; do echo $i ; done
    - To checkout each run this: for i in `cat ./br` ; do git checkout $i ; done
    - now we have all the branches
    - Now we will remove the git origin under .git
        - git remote rm origin
        - cat .git/config (should now be all clear)
    - Now we will add aws code commit in here (Click clone URL on the AWS Code Commit):
        - git remote add origin ssh://git-codecommit.us-east-2.amazonaws.com/v1/repos/vprofile-code-repo
        - git push origin --all (This will push all the checkout branches to aws code commit, can view it there now.)
        

Step 2: Code Artifact Setup
    - Create AWS Code Artifact, we will connect this to the maven store to grab the dependencies for our code. We will need the dependencies for AWS CodeBuild REVIEW
    process. 
        - Connect the AWS Code Artifact to Maven store
        - Create Domain Name for this Account - mandohashdevops
        - After createdd,  you shoukld see 2 repos under the artifact. We will point to the maven central store repo.
        - Click on View connection instructructions. We will PULL, mvn, Review Step 3-6. We will need to open VS code and go to vprofile-project.
        - Browse to the ci-aws branch and under aws-files, open sonar_buildspec.yml. We will run these commands through the buildspec file.
        - Before running, lets review the pom.xml file and the settings.xml file.  
            - So the buildspec file will export the AWS variable for token. And the settings.xml file will grab it.
            - The repo details are mentioned in the pom.xml file and authentication info is in the settings.xml (token)
        - The build spec file is to create the sonar cloud setup. All the details will be saved in the codebuild.
        - login to sonarcloud.io using github. 
        - Click my account, security, generate token. 
        - Create new organization. Give a unique name and free plan. 
        - CLick Analyze project manually
        - display name: vprofile-repo
        - Project key - mandohashdevops_vprofile-repo, public profile. 
        - New code for project, we will use previous version. Click create.
        - Go to the project, repo, expand side bar and click Information. Grab the organization key. mandohashdevops
        - Go to the buildspec file. The env variables, parameter-store can be stored in a secret store. 
            - Go to AWS Systems Manager
            - Click on Parameter store on the side bar. 
            - Lets start grabbing all the parameters from the buildspec file and store the details in the AWS parameter store:
                - Organization: use organization key from sonar cloud
                - HOST: https://sonarcloud.io
                - Project: use project key from sonar cloud
                - LOGIN: secure string - the token from sonar cloud 